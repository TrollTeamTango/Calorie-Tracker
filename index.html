<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Calorie Tracker</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef } = React;
        const Camera = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>);
        const Upload = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>);
        const Loader2 = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" /></svg>);
        const Utensils = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 002-2V2M7 2v20M21 15V2v0a5 5 0 00-5 5v6c0 1.1.9 2 2 2h3v0z" /></svg>);
        const TrendingUp = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>);
        const Calendar = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>);
        const Target = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2} /><circle cx="12" cy="12" r="6" strokeWidth={2} /><circle cx="12" cy="12" r="2" strokeWidth={2} /></svg>);
        const Settings = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>);
        const X = ({className}) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>);

        function CalorieTracker() {
            const [image, setImage] = useState(null);
            const [analyzing, setAnalyzing] = useState(false);
            const [result, setResult] = useState(null);
            const [history, setHistory] = useState([]);
            const [showGoalSetup, setShowGoalSetup] = useState(false);
            const [calorieGoal, setCalorieGoal] = useState(null);
            const [userName, setUserName] = useState('');
            const [goalForm, setGoalForm] = useState({name: '', age: '', gender: 'male', weight: '', height: '', activityLevel: 'moderate', goal: 'maintain'});
            const fileInputRef = useRef(null);
            const cameraInputRef = useRef(null);

            const calculateBMR = () => {
                const { age, gender, weight, height } = goalForm;
                if (!age || !weight || !height) return 0;
                const weightKg = parseFloat(weight), heightCm = parseFloat(height), ageYears = parseInt(age);
                return gender === 'male' ? (10 * weightKg) + (6.25 * heightCm) - (5 * ageYears) + 5 : (10 * weightKg) + (6.25 * heightCm) - (5 * ageYears) - 161;
            };

            const calculateTDEE = () => {
                const bmr = calculateBMR();
                const mult = {sedentary: 1.2, light: 1.375, moderate: 1.55, active: 1.725, veryActive: 1.9};
                return Math.round(bmr * mult[goalForm.activityLevel]);
            };

            const calculateGoalCalories = () => calculateTDEE() + {lose: -500, maintain: 0, gain: 500}[goalForm.goal];

            const handleSetGoal = () => {
                setCalorieGoal(calculateGoalCalories());
                setUserName(goalForm.name);
                setShowGoalSetup(false);
            };

            const analyzeImage = async (imageData) => {
                setAnalyzing(true);
                setResult(null);
                try {
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            messages: [{
                                role: "user",
                                content: [{type: "image", source: {type: "base64", media_type: "image/jpeg", data: imageData}},
                                    {type: "text", text: 'Analyze this food image and provide a calorie estimate. Respond ONLY with a JSON object in this exact format (no markdown, no backticks, no extra text):\n{"foodItems": ["item1", "item2"], "totalCalories": number, "breakdown": [{"item": "item1", "calories": number, "portion": "description"}], "protein": number, "carbs": number, "fat": number, "confidence": "high/medium/low"}'}]
                            }]
                        })
                    });
                    const data = await response.json();
                    const text = data.content.map(item => item.type === "text" ? item.text : "").join("");
                    const parsed = JSON.parse(text.replace(/```json|```/g, "").trim());
                    setResult(parsed);
                    setHistory(prev => [{id: Date.now(), timestamp: new Date().toISOString(), image, ...parsed}, ...prev].slice(0, 10));
                } catch (error) {
                    console.error("Analysis error:", error);
                    setResult({error: "Unable to analyze image. Please ensure API is configured correctly."});
                } finally {
                    setAnalyzing(false);
                }
            };

            const handleFileSelect = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const base64Data = event.target.result.split(',')[1];
                    setImage(event.target.result);
                    await analyzeImage(base64Data);
                };
                reader.readAsDataURL(file);
            };

            const getTodayTotal = () => {
                const today = new Date().toDateString();
                return history.filter(e => new Date(e.timestamp).toDateString() === today).reduce((s, e) => s + (e.totalCalories || 0), 0);
            };

            const getCalorieProgress = () => calorieGoal ? Math.round((getTodayTotal() / calorieGoal) * 100) : 0;
            const getRemainingCalories = () => calorieGoal ? calorieGoal - getTodayTotal() : 0;

            return React.createElement('div', {className: 'min-h-screen bg-gradient-to-br from-green-50 to-blue-50 pb-20'},
                React.createElement('div', {className: 'max-w-2xl mx-auto p-4'},
                    React.createElement('div', {className: 'bg-white rounded-2xl shadow-lg p-6 mb-6'},
                        React.createElement('div', {className: 'flex items-center justify-between mb-4'},
                            React.createElement('div', {className: 'flex items-center gap-3'},
                                React.createElement('div', {className: 'bg-green-500 p-3 rounded-full'}, React.createElement(Utensils, {className: 'w-6 h-6 text-white'})),
                                React.createElement('div', null,
                                    React.createElement('h1', {className: 'text-2xl font-bold text-gray-800'}, userName ? `${userName}'s Tracker` : 'Calorie Tracker'),
                                    React.createElement('p', {className: 'text-sm text-gray-600'}, 'Snap, analyze, track')
                                )
                            ),
                            React.createElement('button', {onClick: () => setShowGoalSetup(true), className: 'p-2 hover:bg-gray-100 rounded-full'}, React.createElement(Settings, {className: 'w-6 h-6 text-gray-600'}))
                        ),
                        React.createElement('div', {className: 'bg-gradient-to-r from-green-100 to-blue-100 rounded-xl p-4'},
                            React.createElement('div', {className: 'flex items-center justify-between mb-3'},
                                React.createElement('div', null,
                                    React.createElement('p', {className: 'text-sm text-gray-600 mb-1'}, "Today's Total"),
                                    React.createElement('p', {className: 'text-3xl font-bold text-gray-800'}, getTodayTotal()),
                                    React.createElement('p', {className: 'text-sm text-gray-600'}, calorieGoal ? `of ${calorieGoal} calories` : 'calories')
                                ),
                                React.createElement(Calendar, {className: 'w-12 h-12 text-green-600 opacity-50'})
                            ),
                            calorieGoal && React.createElement('div', null,
                                React.createElement('div', {className: 'flex justify-between text-sm text-gray-600 mb-2'},
                                    React.createElement('span', null, `${getCalorieProgress()}% of goal`),
                                    React.createElement('span', {className: getRemainingCalories() >= 0 ? 'text-green-600' : 'text-red-600'},
                                        getRemainingCalories() >= 0 ? `${getRemainingCalories()} left` : `${Math.abs(getRemainingCalories())} over`
                                    )
                                ),
                                React.createElement('div', {className: 'w-full bg-gray-200 rounded-full h-3'},
                                    React.createElement('div', {
                                        className: `h-3 rounded-full transition-all ${getCalorieProgress() > 100 ? 'bg-red-500' : 'bg-gradient-to-r from-green-500 to-blue-500'}`,
                                        style: {width: `${Math.min(getCalorieProgress(), 100)}%`}
                                    })
                                )
                            ),
                            !calorieGoal && React.createElement('button', {
                                onClick: () => setShowGoalSetup(true),
                                className: 'w-full mt-2 bg-white text-green-600 font-medium py-2 px-4 rounded-lg hover:bg-gray-50 flex items-center justify-center gap-2'
                            }, React.createElement(Target, {className: 'w-4 h-4'}), 'Set Your Calorie Goal')
                        )
                    ),
                    showGoalSetup && React.createElement('div', {className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50'},
                        React.createElement('div', {className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto'},
                            React.createElement('div', {className: 'sticky top-0 bg-white border-b p-4 flex items-center justify-between'},
                                React.createElement('div', {className: 'flex items-center gap-2'}, 
                                    React.createElement(Target, {className: 'w-6 h-6 text-green-600'}),
                                    React.createElement('h2', {className: 'text-xl font-bold'}, 'Calculate Your Goal')
                                ),
                                React.createElement('button', {onClick: () => setShowGoalSetup(false), className: 'p-1 hover:bg-gray-100 rounded-full'}, React.createElement(X, {className: 'w-6 h-6'}))
                            ),
                            React.createElement('div', {className: 'p-6 space-y-4'},
                                ['name', 'age', 'weight', 'height'].map(field => 
                                    React.createElement('div', {key: field},
                                        React.createElement('label', {className: 'block text-sm font-medium text-gray-700 mb-2'}, 
                                            field === 'name' ? 'Name' : field === 'age' ? 'Age' : field === 'weight' ? 'Weight (kg)' : 'Height (cm)'
                                        ),
                                        React.createElement('input', {
                                            type: field === 'name' ? 'text' : 'number',
                                            value: goalForm[field],
                                            onChange: (e) => setGoalForm({...goalForm, [field]: e.target.value}),
                                            className: 'w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500',
                                            placeholder: field === 'name' ? 'Your name' : ''
                                        })
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', {className: 'block text-sm font-medium text-gray-700 mb-2'}, 'Gender'),
                                    React.createElement('select', {value: goalForm.gender, onChange: (e) => setGoalForm({...goalForm, gender: e.target.value}), className: 'w-full px-4 py-2 border rounded-lg'},
                                        React.createElement('option', {value: 'male'}, 'Male'),
                                        React.createElement('option', {value: 'female'}, 'Female')
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', {className: 'block text-sm font-medium mb-2'}, 'Activity Level'),
                                    React.createElement('select', {value: goalForm.activityLevel, onChange: (e) => setGoalForm({...goalForm, activityLevel: e.target.value}), className: 'w-full px-4 py-2 border rounded-lg'},
                                        ['sedentary', 'light', 'moderate', 'active', 'veryActive'].map(level =>
                                            React.createElement('option', {key: level, value: level}, 
                                                level === 'sedentary' ? 'Sedentary' : level === 'light' ? 'Light (1-3 days/week)' : 
                                                level === 'moderate' ? 'Moderate (3-5 days/week)' : level === 'active' ? 'Active (6-7 days/week)' : 'Very Active'
                                            )
                                        )
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', {className: 'block text-sm font-medium mb-2'}, 'Goal'),
                                    React.createElement('select', {value: goalForm.goal, onChange: (e) => setGoalForm({...goalForm, goal: e.target.value}), className: 'w-full px-4 py-2 border rounded-lg'},
                                        React.createElement('option', {value: 'lose'}, 'Lose Weight (-500 cal/day)'),
                                        React.createElement('option', {value: 'maintain'}, 'Maintain Weight'),
                                        React.createElement('option', {value: 'gain'}, 'Gain Weight (+500 cal/day)')
                                    )
                                ),
                                goalForm.age && goalForm.weight && goalForm.height && React.createElement('div', {className: 'bg-green-50 border border-green-200 rounded-xl p-4'},
                                    React.createElement('p', {className: 'text-sm text-gray-600'}, 'Your Target Calories'),
                                    React.createElement('p', {className: 'text-3xl font-bold text-green-600'}, calculateGoalCalories()),
                                    React.createElement('p', {className: 'text-xs text-gray-500 mt-2'}, `Based on TDEE: ${calculateTDEE()} cal/day`)
                                ),
                                React.createElement('button', {
                                    onClick: handleSetGoal,
                                    disabled: !goalForm.age || !goalForm.weight || !goalForm.height,
                                    className: 'w-full bg-gradient-to-r from-green-500 to-green-600 text-white font-medium py-3 rounded-lg disabled:opacity-50'
                                }, 'Set Goal')
                            )
                        )
                    ),
                    React.createElement('div', {className: 'bg-white rounded-2xl shadow-lg p-6 mb-6'},
                        React.createElement('h2', {className: 'text-lg font-semibold mb-4'}, 'Add Meal'),
                        React.createElement('div', {className: 'grid grid-cols-2 gap-4'},
                            React.createElement('button', {onClick: () => cameraInputRef.current?.click(), className: 'flex flex-col items-center gap-2 bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl'},
                                React.createElement(Camera, {className: 'w-8 h-8'}), React.createElement('span', {className: 'font-medium'}, 'Take Photo')
                            ),
                            React.createElement('button', {onClick: () => fileInputRef.current?.click(), className: 'flex flex-col items-center gap-2 bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl'},
                                React.createElement(Upload, {className: 'w-8 h-8'}), React.createElement('span', {className: 'font-medium'}, 'Upload Photo')
                            )
                        ),
                        React.createElement('input', {ref: cameraInputRef, type: 'file', accept: 'image/*', capture: 'environment', onChange: handleFileSelect, style: {display: 'none'}}),
                        React.createElement('input', {ref: fileInputRef, type: 'file', accept: 'image/*', onChange: handleFileSelect, style: {display: 'none'}})
                    ),
                    (image || analyzing) && React.createElement('div', {className: 'bg-white rounded-2xl shadow-lg p-6 mb-6'},
                        image && React.createElement('img', {src: image, alt: 'Food', className: 'w-full h-64 object-cover rounded-xl mb-4'}),
                        analyzing && React.createElement('div', {className: 'flex flex-col items-center py-8 gap-3'},
                            React.createElement(Loader2, {className: 'w-12 h-12 text-green-500 animate-spin'}),
                            React.createElement('p', {className: 'text-gray-600'}, 'Analyzing your meal...')
                        ),
                        result && !result.error && React.createElement('div', {className: 'space-y-4'},
                            React.createElement('div', {className: 'bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl p-6 text-center'},
                                React.createElement('p', {className: 'text-sm opacity-90 mb-1'}, 'Total Calories'),
                                React.createElement('p', {className: 'text-5xl font-bold'}, result.totalCalories),
                                React.createElement('p', {className: 'text-sm opacity-90 mt-2'}, `Confidence: ${result.confidence}`)
                            ),
                            React.createElement('div', {className: 'grid grid-cols-3 gap-3'},
                                [{label: 'Protein', value: result.protein, color: 'red'}, {label: 'Carbs', value: result.carbs, color: 'yellow'}, {label: 'Fat', value: result.fat, color: 'purple'}].map(({label, value, color}) =>
                                    React.createElement('div', {key: label, className: `bg-${color}-50 rounded-lg p-3 text-center`},
                                        React.createElement('p', {className: 'text-xs text-gray-600 mb-1'}, label),
                                        React.createElement('p', {className: `text-xl font-bold text-${color}-600`}, `${value}g`)
                                    )
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('h3', {className: 'font-semibold mb-3'}, 'Breakdown'),
                                React.createElement('div', {className: 'space-y-2'},
                                    result.breakdown.map((item, i) =>
                                        React.createElement('div', {key: i, className: 'flex justify-between items-center bg-gray-50 rounded-lg p-3'},
                                            React.createElement('div', null,
                                                React.createElement('p', {className: 'font-medium'}, item.item),
                                                React.createElement('p', {className: 'text-xs text-gray-500'}, item.portion)
                                            ),
                                            React.createElement('p', {className: 'font-bold text-green-600'}, `${item.calories} cal`)
                                        )
                                    )
                                )
                            )
                        ),
                        result?.error && React.createElement('div', {className: 'bg-red-50 border border-red-200 rounded-xl p-4 text-red-700'}, result.error)
                    ),
                    history.length > 0 && React.createElement('div', {className: 'bg-white rounded-2xl shadow-lg p-6'},
                        React.createElement('div', {className: 'flex items-center gap-2 mb-4'},
                            React.createElement(TrendingUp, {className: 'w-5 h-5'}),
                            React.createElement('h2', {className: 'text-lg font-semibold'}, 'Recent Meals')
                        ),
                        React.createElement('div', {className: 'space-y-3'},
                            history.map(entry =>
                                React.createElement('div', {key: entry.id, className: 'flex gap-3 bg-gray-50 rounded-xl p-3'},
                                    React.createElement('img', {src: entry.image, alt: 'Meal', className: 'w-20 h-20 object-cover rounded-lg'}),
                                    React.createElement('div', {className: 'flex-1'},
                                        React.createElement('p', {className: 'font-medium'}, entry.foodItems.join(', ')),
                                        React.createElement('p', {className: 'text-sm text-gray-500'}, new Date(entry.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})),
                                        React.createElement('p', {className: 'text-lg font-bold text-green-600 mt-1'}, `${entry.totalCalories} cal`)
                                    )
                                )
                            )
                        )
                    )
                )
            );
        }
        ReactDOM.render(React.createElement(CalorieTracker), document.getElementById('root'));
    </script>
</body>
</html>
